#!/bin/bash

awscli () {
  docker run --rm -it \
  -v $(pwd):/home/nikovirtala \
  -v "${HOME}/.aws:/home/nikovirtala/.aws" \
  nikovirtala/awscli:latest
}

aws-shell () {
  docker run --rm -it \
  -v "${HOME}/.aws:/root/.aws" \
  nikovirtala/aws-shell:latest
}

cfssl () {
  docker run --rm \
  -v "$(pwd):/home/nikovirtala" \
  nikovirtala/cfssl:latest
}

cfssljson () {
  docker run --rm -i \
  -v "$(pwd):/home/nikovirtala" \
  nikovirtala/cfssljson:latest
}

jq () {
  docker run --rm -i \
  -v "$(pwd):/home/nikovirtala" \
  nikovirtala/jq:latest "$@"
}

kubectl () {
  docker run --rm -i \
    -v "$(pwd):/home/nikovirtala" \
    -v "${HOME}/.kube:/home/nikovirtala/.kube" \
    nikovirtala/kubectl:latest "$@"
}

gcloud () {
  docker run --rm -it \
  -v "$(pwd):/home/nikovirtala" \
  -v "${HOME}/.config:/home/nikovirtala/.config" \
  -v "${HOME}/.ssh/:/home/nikovirtala/.ssh" \
  -v "${HOME}/.kube/:/home/nikovirtala/.kube" \
  google/cloud-sdk:alpine gcloud "$@"
}

packer () {
  docker run --rm -it \
  -v "$(pwd):/root" \
  hashicorp/packer:light
}

packer-full () {
  docker run --rm -it \
  -v "$(pwd):/root" \
  hashicorp/packer:full
}

terraform () {
  docker run --rm -it \
  -v "${HOME}/.aws:/root/.aws" \
  -v "$(pwd):/root" \
  hashicorp/terraform:light
}

terraform-full () {
  docker run --rm -it \
  -v "${HOME}/.aws:/root/.aws" \
  -v "$(pwd):/root" \
  hashicorp/terraform:full
}

get-docker-node-ip () {
  docker node inspect $1 --format '{{.Status.Addr}}'
}

get-ucp-bundle () {
  local UCPFQDN=$1
  local UCPUSER=$2
  local UCPPASS=$3
  local AUTHTOKEN=$(curl -sLk "https://${UCPFQDN}/auth/login" -d "{\"username\":\"${UCPUSER}\",\"password\":\"${UCPPASS}\"}" | jq -r .auth_token)

  # Download the client certificate bundle
  curl -k -H "Authorization: Bearer ${AUTHTOKEN}" https://${UCPFQDN}/api/clientbundle -o ucp-bundle-for-${UCPFQDN}.zip
}

